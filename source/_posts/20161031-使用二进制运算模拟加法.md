---
title: 使用二进制运算模拟加法 AddWithoutArithmetic
date: 2016-10-31 10:28:35
tags: [JS,位操作,算法]
---
## 代码如下：

```` c
     int AddWithoutArithmetic(int num1, int num2){
           int sum, carry;
           if (0 == num2){
               return num1;
           }
           sum = num1 ^ num2;
           carry = (num1 & num2) << 1;
           return AddWithoutArithmetic(sum, carry);
     }
````
## JS版代码

```` javascript
     function addWithOutArithmetic( a , b){
       if( b === 0 ){ return a;} // 递归的退出的条件

       c = a ^ b; // 按位异或运算, 对等长二进制模式按位或二进制数的每一位执行逻辑按位异或操作. 操作的结果是如果某位不同则该位为1, 否则该位为0.

       d = ( a & b ) << 1; // 按位与运算, 相同位的两个数字都为1，则为1；若有一个不为1，则为0。
                            // 左移1位

       return addWithOutArithmetic( c , d); // 递归
     }
````

## 模拟执行看看

- `addWithOutArithmetic(1,2)`
- 开始运算 b的值为 2 a的值为 1
- c的值 3 二进制表示为 11 c来源 a^b 即 1  ^  10
- d的值 0 二进制表示为 0 d来源 a & b 即 1  &  10 结果 0 然后左移1位 0
- 开始下一次循环
- 开始运算 b的值为 0 a的值为 3
- b的值为0,返回a的值 3
- `3`


- `addWithOutArithmetic(4,8)`
- 开始运算 b的值为 8 a的值为 4
- c的值 12 二进制表示为 1100 c来源 a^b 即 100  ^  1000
- d的值 0 二进制表示为 0 d来源 a & b 即 100  &  1000 结果 0 然后左移1位 0
- 开始下一次循环
- 开始运算 b的值为 0 a的值为 12
- b的值为0,返回a的值 12
- `12`


- `addWithOutArithmetic(11,17)`
- 开始运算 b的值为 17 a的值为 11
- c的值 26 二进制表示为 11010 c来源 a^b 即 1011  ^  10001
- d的值 2 二进制表示为 10 d来源 a & b 即 1011  &  10001 结果 1 然后左移1位 2
- 开始下一次循环
- 开始运算 b的值为 2 a的值为 26
- c的值 24 二进制表示为 11000 c来源 a^b 即 11010  ^  10
- d的值 4 二进制表示为 100 d来源 a & b 即 11010  &  10 结果 2 然后左移1位 4
- 开始下一次循环
- 开始运算 b的值为 4 a的值为 24
- c的值 28 二进制表示为 11100 c来源 a^b 即 11000  ^  100
- d的值 0 二进制表示为 0 d来源 a & b 即 11000  &  100 结果 0 然后左移1位 0
- 开始下一次循环
- 开始运算 b的值为 0 a的值为 28
- b的值为0,返回a的值 28
- `28`

## 模拟执行的测试脚本

```` javascript
function addWithOutArithmetic( a , b){
  console.info('开始运算','b的值为',b,'a的值为',a)
  if( b === 0 ){console.warn('b的值为0,返回a的值',a); return a;} // 递归的退出的条件


  c = a ^ b; // 按位异或运算, 对等长二进制模式按位或二进制数的每一位执行逻辑按位异或操作. 操作的结果是如果某位不同则该位为1, 否则该位为0.

  console.log('c的值',c,'二进制表示为',new Number(c).toString(2),'c来源 a^b 即',(a).toString(2),' ^ ',(b).toString(2) );

  d = ( a & b ) << 1; // 按位与运算, 相同位的两个数字都为1，则为1；若有一个不为1，则为0。
                       // 左移1位

  console.log('d的值',d,'二进制表示为',(d).toString(2),'d来源 a & b 即',(a).toString(2),' & ',(b).toString(2),'结果',a&b, '然后左移1位', (a&b) << 1 );

  console.warn('开始下一次循环')
  return addWithOutArithmetic( c , d); // 递归
}



// addWithOutArithmetic( 1 , 2 )
  // b == 2 继续
  // c = 3 ;  ===> 01 ^ 10  ===> 0位、1位，都不同，都为 1 ===> 11 ===> 3  ；注意 c 的值在下一次循环中，变量名为 a
  // d = 0 ;  ===> 01 & 10  ===> 需要两个数的同位同时为 1 ====> 00 ===> 0 ；注意 d 的的值在下一次循环中，变量名为 b

  // b == 0 ，返回 a 的值（上一轮为3)


````
