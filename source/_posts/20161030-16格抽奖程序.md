---
title: 16格抽奖程序
date: 2016-10-30 09:51:21
tags: [js特效,单页应用]
---

有时候需要个抽奖的界面，现在抽出来单独做个应用，年会上抽奖可以用。

## 运行界面：

[预览地址](/ddemo/reward-maching.html)

![效果预览](/images/2016-10-30 10.18.29.png)


## 关键代码


#### 盒子设定

```` javascript
var size = 5;


var items = [];
var items_top = [];
var items_bottom=[]
var items_right = [];
var items_left = [];

var box = $('.box');  // 容器

box.css('width',size*100+'px'); // 默认100*100 是每个格子的大小
box.css('height',size*100+'px')


````


#### 插入中奖方块

```` javascript
$.each(Array(size),function (x) {
  $.each(Array(size),function (y) {
      var idx = x*size + y;
      var id = 'i_'+idx;
      box.append('<div class="box__item" data-idx="'+idx+'" id="'+id+'">');

      // 把id分成四个部分
      if( idx > size  && idx%size == size-1 && idx < size*size-size){
        items_right.push(id);
      }
      if( idx > size-1  && idx%size == 0 && idx < size*size-size){
        items_left.push(id);
      }
      if( idx< size){
        items_top.push(id);
      }
      if(idx > size*size-size-1  ){
          items_bottom.push(id);
      }

  });        
});
````

#### 调整id顺序为逆时针

```` javascript
items = items_top.join(',')+','+items_right.join(',')+','+items_bottom.reverse().join(',')+','+items_left.reverse().join(',');
items = items.split(',');

$.each(items,function  (i,id) {
  $('#'+id).text(i+1)
})

````

#### 抽奖开始

```` javascript

var last = '';  // 重新开始会从上一个结束的地方开始
var go = function (num) {

    var end = items.slice(0,num+1).join(',');

    var all = items.join(',');
    var arr = (last+all+','+all+','+all+','+end).split(',');
    var len = arr.length -1;

     last = items.slice(num+1).join(',')+',';

    $.each(arr,function  (i,item) {
      setTimeout(function  () {
        $('.box__item').removeClass('highlight');
        $('#'+item).addClass('highlight');
      },100*i); // 这个动画效果 ~_~!!!

    })
}

go( ~~ (Math.random()*items.length )  )
````
